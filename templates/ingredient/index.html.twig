{% extends 'base.html.twig' %}

{% block body %}

<h1>Liste des ingrédients</h1>

{# ------------------------------------------ #}
{# 1) Info de l'utilisateur connecté          #}
{# ------------------------------------------ #}

{% if app.user %}
    <p>
        Connecté en tant que 
        <strong>{{ app.user.email }}</strong>
    </p>

    <a href="{{ path('app_logout') }}" class="btn btn-secondary">
        Se déconnecter
    </a>

{% else %}
    <a href="{{ path('app_login') }}" class="btn btn-primary">
        Se connecter
    </a>
{% endif %}

<hr>

{# ------------------------------------------ #}
{# 2) Bouton créer un ingrédient (ROLE_USER) #}
{# ------------------------------------------ #}

{% if is_granted('ROLE_USER') %}
    <a href="{{ path('ingredient.create') }}" class="btn btn-success mb-3">
        + Créer un ingrédient
    </a>
{% endif %}

<table class="table">
    <thead>
        <tr>
            <th>Nom</th>
            <th>Prix</th>
            <th>Date de création</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>

    {% for ingredient in ingredients %}
        <tr>
            <td>{{ ingredient.nom }}</td>
            <td>{{ ingredient.prix }} €</td>
            <td>{{ ingredient.createdAt ? ingredient.createdAt|date('d/m/Y') : '' }}</td>

            <td>
                {# ------------------------------------------------------------ #}
                {# 3) Modifier / Supprimer visibles SEULEMENT pour ROLE_ADMIN  #}
                {# ------------------------------------------------------------ #}

                {% if is_granted('ROLE_ADMIN') %}
                    <a href="{{ path('ingredient.edit', {id: ingredient.id}) }}" 
                       class="btn btn-warning btn-sm">
                        Modifier
                    </a>

                    <form method="post"
                          action="{{ path('ingredient.delete', {id: ingredient.id}) }}"
                          style="display:inline-block;"
                          onsubmit="return confirm('Supprimer cet ingrédient ?');">
                        <input type="hidden" name="_method" value="DELETE">
                        <button class="btn btn-danger btn-sm">Supprimer</button>
                    </form>
                {% else %}
                    <span class="text-muted">-</span>
                {% endif %}
            </td>
        </tr>
    {% endfor %}

    </tbody>
</table>

{% endblock %}
